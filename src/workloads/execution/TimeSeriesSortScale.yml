SchemaVersion: 2018-07-01
Owner: "@mongodb/query"
Description: |
  TODO explain this


GlobalDefaults:
  dbname: &db test
  batchSize: &batchSize 30000
  fieldName: &field "numeric"
  index: &index
    keys: {numeric: 1}
  nop: &Nop {Nop: true}

Actors:
- Name: CreateTimeSeriesCollection
  Type: RunCommand
  Threads: 1
  Phases:
  - Repeat: 1
    Database: *db
    Operation:
      OperationMetricsName: CreateTimeSeriesCollection
      OperationName: RunCommand
      OperationCommand:
        {create: &coll Collection0, timeseries: {timeField: "t", metaField: "m"}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - *Nop

- Name: Quiesce
  Type: QuiesceActor
  Threads: 1
  Database: *db
  Phases:
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop
  - *Nop
  - Repeat: 1
  - *Nop
  - Repeat: 1
  - *Nop

- Name: InsertData
  Type: Loader
  Threads: 1
  Phases:
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2000-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2001-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2002-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2003-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2004-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2005-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2006-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2007-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2008-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2009-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2010-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2011-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2012-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2013-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop
  - Repeat: 1
    Database: *db
    Collection: *coll
    Threads: 1
    CollectionCount: 1
    DocumentCount: 1e6
    BatchSize: *batchSize
    Document:
      t: {^IncDate: {start: "2014-01-01", step: 400}}
      m: {^RandomInt: {min: 0, max: 1000}}
  - *Nop
  - *Nop
  - *Nop
  - *Nop

- Name: Queries
  Type: RunCommand
  Threads: 1
  Phases:
  - *Nop
  - *Nop
  - *Nop
  - Repeat: &numQueryRuns 1
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort1M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort1M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort2M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort2M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort3M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort3M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort4M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort4M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort5M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort5M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort6M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort6M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort7M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort7M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort8M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort8M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort9M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort9M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort10M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort10M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort11M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort11M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort12M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort12M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort13M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort13M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort14M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort14M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}
  - *Nop
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBlockingSort15M
      OperationName: RunCommand
      OperationCommand:
        aggregate: *coll
        pipeline: [{$sort: {t: 1}}, {$_internalInhibitOptimization: {}}, {$skip: 1e10}]
        cursor: {batchSize: *batchSize}
        allowDiskUse: true
  - *Nop
  - Repeat: *numQueryRuns
    Database: *db
    Operations:
    - OperationMetricsName: SortQuerySpillBoundedSort15M
      OperationName: RunCommand
      OperationCommand:
        aggregate: system.buckets.Collection0
        pipeline: [
          {$_internalUnpackBucket: {
            exclude: [],
            timeField: "t",
            metaField: "m",
            bucketMaxSpanSeconds: 3600,
            assumeNoMixedSchemaData: true
          }},
          {$_internalBoundedSort: {
            sortKey: {t: 1},
            bound: {base: "min"},
          }},
          {$_internalInhibitOptimization: {}},
          {$skip: 1e10}
        ]
        cursor: {batchSize: *batchSize}
        hint: {$natural: 1}


AutoRun:
- When:
    mongodb_setup:
      $eq:
      - replica
      - replica-all-feature-flags
    branch_name:
      $neq:
      - v4.0
      - v4.2
      - v4.4
      - v5.0
      - v5.1
      - v5.2
      - v5.3
